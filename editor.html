<!doctype html>
<html lang="en">
<head>
<style>
#editor {
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	font-size: 1em;
	font-family: "Source Code Pro", "Consolas", "Monaco", "Courier New", monospace
}
</style>
</head>
<body>

<div id="editor"></div>

<textarea id="boilerplate" style="display:none"><!doctype html>
<html lang="en">
<head>
<style>
body {
	font-family: sans-serif;
}
</style>
</head>
<body>

<button>Hello World</button>

<script src="//code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
(function(){

	$('button').on('click', function(){
		alert('boom!');
	});

})();
</script>

</body>
</html></textarea>

<script src="components/ace-builds/src-min/ace.js" charset="utf-8"></script>
<script>

	// grab the hash fro the parent frame
	var hash = parent.location.hash;

	if(!hash){
		// no hash. let's set the hash to a timestamp and start over
		parent.location.hash = new Date().getTime()
		return;
	}


	var code = localStorage.getItem(hash) || document.getElementById('boilerplate').value;

	var editor = ace.edit('editor');
	editor.setTheme('ace/theme/solarized_dark'),
	editor.getSession().setMode('ace/mode/html');
	editor.getSession().setTabSize(4);
	editor.getSession().setUseSoftTabs(true);
	editor.on('change', function(e){
		code = editor.getValue();
		localStorage.setItem(hash, code)
		parent.postMessage(code, '*');
	});
	editor.setValue(code);
	editor.clearSelection();
	editor.focus();
</script>

</body>
</html>
