<!doctype html>
<html lang="en">
<head>
<title>Scratchpad</title>
<style>
html,
body {
	height: 100%;
	margin: 0;
	padding: 0;
}

iframe {
	border: none;
	width: 100%;
	height: 100%;
	position: fixed;
}

[name=editor]{
	top: 0;
	bottom: 0;
	left: 0;
	width: 50%;
}

[name=viewer]{
	top: 0;
	right: 0;
	bottom: 0;
	width: 50%;
}
</style>
</head>
<body>
	<a href="http://mundizzle.github.io/scratchpad/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

	<iframe name="editor" src="editor.html"></iframe>
	<iframe name="viewer"></iframe>
	<script>
	// anytime the editor content changes, this is triggered
	window.addEventListener('message', function(e) {

		// reference to the viewer iframe
		var viewer = window.viewer;
		var viewerDoc = viewer.document;

		// grab the code currently in the editor
		// and innerHTML it into the viewer
		viewerDoc.documentElement.innerHTML = e.data;

		// OK. cool! HTML and CSS work fine, however JS will
		// not be executed when innerHTML'd
		// so we have to find all the <script> tags
		// and manually execute them

		// find all the script tags
		var scripts = viewerDoc.getElementsByTagName('script')

		var script;
		for (var i = 0; i < scripts.length; i++) {

			script = scripts[i];

			// create a new script element
			var newScript = document.createElement('script');

			// script tags will contain code or have a src attr
			// so we'll store a reference to both
			var code = script.innerText;
			var src = script.getAttribute('src');

			// if the tag has a src, let's ajax it in syncronously
			// in order to preserve the order of execution
			if(src){
				var xhr = new XMLHttpRequest();
				xhr.open( 'GET', src, false ); // async = false
				xhr.send( null );
				code = xhr.responseText;
			}

			// now append our "code" into the new script tag
			newScript.innerText = code;

			// and replace the old with the new. now the JS should execute
			script.parentNode.replaceChild(newScript, script);

		}
	}, false);
	</script>
</body>
</html>
